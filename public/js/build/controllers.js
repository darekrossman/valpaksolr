// Generated by CoffeeScript 1.6.2
(function() {
  var module;

  module = angular.module('app.controllers', []);

  module.controller('AppController', [
    '$scope', 'ListingFilter', function($scope, ListingFilter) {
      return $scope.listingFilter = ListingFilter;
    }
  ]);

  module.controller('HomeController', ['$scope', function($scope) {}]);

  module.controller('ToolbarController', [
    '$scope', '$route', 'ListingFilter', function($scope, $route, ListingFilter) {
      $scope.layout = ListingFilter.layoutOption;
      if ($route.current.params.keywords) {
        ListingFilter.resultsLabel = "Showing results for: '" + $route.current.params.keywords + "'";
      } else {
        ListingFilter.resultsLabel = $route.current.params.cat;
      }
      return $scope.setLayout = function(layout) {
        ListingFilter.layoutOption = layout;
        $scope.layout = layout;
        return localStorage.setItem('layout_option', layout);
      };
    }
  ]);

  module.controller('SearchController', [
    '$scope', '$location', 'ListingFilter', function($scope, $location, ListingFilter) {
      $scope.listingFilter = ListingFilter;
      return $scope.queryKeyword = function() {
        console.log('QUERYING');
        return $location.url("/search/?keywords=" + ListingFilter.searchText);
      };
    }
  ]);

  module.controller('SidebarController', ['$scope', function($scope) {}]);

  module.controller('ListingController', [
    '$scope', '$location', '$route', '$rootScope', '$q', 'KeywordListingLoader', 'CategoryListingsLoader', 'ListingFilter', function($scope, $location, $route, $q, $rootScope, KeywordListingLoader, CategoryListingsLoader, ListingFilter) {
      var delay, getListings, requestedPage;

      requestedPage = $route.current.params.page;
      $scope.listingFilter = ListingFilter;
      $scope.listings = [];
      ListingFilter.loading = true;
      if ($route.current.params.keywords) {
        if (localStorage.getItem('search_pizza') && $route.current.params.keywords) {
          delay = $q.defer();
          getListings = delay.promise;
          delay.resolve(JSON.parse(localStorage.getItem('search_pizza')));
        } else {
          getListings = KeywordListingLoader();
          ListingFilter.resultsLabel = "Showing results for: '" + $route.current.params.keywords + "'";
        }
      } else if ($route.current.params.cat) {
        getListings = CategoryListingsLoader();
        ListingFilter.resultsLabel = $route.current.params.cat;
      }
      getListings.then(function(listings) {
        if ($route.current.params.keywords === 'pizza') {
          if (!localStorage.getItem('search_pizza')) {
            JSON.stringify(localStorage.setItem('search_pizza', JSON.stringify(listings)));
          }
        }
        $scope.allListings = Array.prototype.concat(listings.keywordCouponsList, listings.keywordGroceryList, listings.keywordSdcCouponsList, listings.keywordDealsList);
        $scope.appendListings();
        return ListingFilter.loading = false;
      });
      $scope.$on('e:scroll', function() {
        return console.log('scrolling!');
      });
      $scope.getLogoSrc = function() {
        if (this.listing.slugTypeId !== null) {
          if (this.listing.logoImageFileName) {
            return 'http://www.valpak.com/img/print/' + this.listing.logoImageFileName;
          } else {
            return '/img/defaultLogo.png';
          }
        } else {
          if (this.listing.logoImageFileName) {
            return this.listing.logoImageFileName;
          } else if (this.listing.dealImageURL) {
            return this.listing.dealImageURL;
          } else {
            return '/img/defaultLogo.png';
          }
        }
      };
      return $scope.appendListings = function() {
        return $scope.listings = $scope.listings.concat($scope.allListings.splice(0, 20));
      };
    }
  ]);

  module.controller('BusinessProfileController', [
    '$scope', '$location', '$route', 'profile', function($scope, $location, $route, profile) {
      $scope.profile = profile;
      return $scope.businessGeo = profile.selectedAddressOffer.geoCoordinates;
    }
  ]);

}).call(this);
